# XHS Video MCP 启动指南

## 前置准备

### 1. 安装 uv（如果还没有）

```bash
# Linux/macOS
curl -LsSf https://astral.sh/uv/install.sh | sh

# 或使用 pip
pip install uv
```

### 2. 配置环境变量

```bash
# 复制示例配置文件
cp env.example .env

# 编辑 .env 文件，填入实际的 API Keys
nano .env  # 或使用其他编辑器
```

**必需的配置项：**
- `LLM_PROVIDER`: LLM 提供商（openai/moonshot/deepseek）
- `OPENAI_API_KEY` 或其他 LLM 的 API Key
- `PEXELS_API_KEYS` 或 `PIXABAY_API_KEYS`（至少一个）

## 启动方式

### 方式一：使用启动脚本（推荐）

```bash
# 进入项目目录
cd xhs-video-mcp

# 使用默认配置启动（0.0.0.0:8005）
./start.sh

# 或指定主机和端口
./start.sh 0.0.0.0 8005
```

### 方式二：使用 uv 直接运行

```bash
# 进入项目目录
cd xhs-video-mcp

# 同步依赖（首次运行或依赖更新后）
uv sync

# 启动服务（默认端口 8005）
uv run xhs-video-mcp

# 指定主机和端口
uv run xhs-video-mcp --host 0.0.0.0 --port 8005
```

### 方式三：使用 Python 模块方式

```bash
# 进入项目目录
cd xhs-video-mcp

# 激活虚拟环境（如果使用 uv）
source .venv/bin/activate  # Linux/macOS
# 或
.venv\Scripts\activate  # Windows

# 运行模块
python -m xhs_video_mcp.main

# 指定参数
python -m xhs_video_mcp.main --host 0.0.0.0 --port 8005
```

### 方式四：安装后使用命令

```bash
# 安装项目
uv pip install -e .

# 或使用 pip
pip install -e .

# 直接运行命令
xhs-video-mcp --host 0.0.0.0 --port 8005
```

## 启动参数

```bash
xhs-video-mcp [选项]

选项:
  --host HOST    服务器主机地址（默认: 0.0.0.0）
  --port PORT    服务器端口（默认: 8005）
  -h, --help     显示帮助信息
```

## 环境变量

也可以通过环境变量设置：

```bash
export MCP_HOST=0.0.0.0
export MCP_PORT=8005
uv run xhs-video-mcp
```

## 验证服务是否启动成功

启动成功后，你会看到类似以下输出：

```
============================================================
小红书视频生成 MCP 服务启动
服务器地址: http://0.0.0.0:8005
============================================================
```

## 测试服务

### 使用 curl 测试

```bash
# 测试服务是否运行
curl http://localhost:8005/health

# 或查看 MCP 工具列表
curl http://localhost:8005/tools
```

### 使用 MCP 客户端连接

服务启动后，可以通过 MCP 客户端连接到：
- 地址: `http://localhost:8005` 或 `http://0.0.0.0:8005`
- 协议: HTTP

## 常见问题

### 1. 端口被占用

```bash
# 查看端口占用
lsof -i :8005  # Linux/macOS
netstat -ano | findstr :8005  # Windows

# 使用其他端口
uv run xhs-video-mcp --port 8006
```

### 2. 依赖安装失败

```bash
# 清理并重新安装
rm -rf .venv uv.lock
uv sync
```

### 3. API Key 未配置

确保 `.env` 文件中配置了必需的 API Keys：
- LLM API Key（OpenAI/Moonshot/DeepSeek）
- 视频素材 API Key（Pexels 或 Pixabay）

### 4. 权限问题（Linux/macOS）

```bash
# 给启动脚本添加执行权限
chmod +x start.sh
```

## 后台运行

### 使用 nohup

```bash
nohup uv run xhs-video-mcp > mcp.log 2>&1 &
```

### 使用 screen

```bash
screen -S xhs-video-mcp
uv run xhs-video-mcp
# 按 Ctrl+A 然后按 D 退出 screen
```

### 使用 tmux

```bash
tmux new -s xhs-video-mcp
uv run xhs-video-mcp
# 按 Ctrl+B 然后按 D 退出 tmux
```

## 停止服务

```bash
# 查找进程
ps aux | grep xhs-video-mcp

# 停止进程（替换 PID 为实际进程号）
kill <PID>

# 或强制停止
kill -9 <PID>
```

## 日志

服务日志会输出到控制台，如果需要保存日志：

```bash
# 重定向到文件
uv run xhs-video-mcp > mcp.log 2>&1

# 或使用 tee 同时输出到控制台和文件
uv run xhs-video-mcp | tee mcp.log
```

