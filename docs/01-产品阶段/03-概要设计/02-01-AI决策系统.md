# 基于 LangGraph 的小红书运营 Agent 工作流设计

## 整体架构：多 Agent 协作图结构

```
                    ┌─────────────────┐
                    │   Entry Node    │
                    │  (请求路由器)    │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
         ┌────▼────┐    ┌────▼────┐   ┌────▼────┐
         │用户请求  │    │平台事件  │   │定时任务  │
         │分支     │    │分支     │   │分支     │
         └────┬────┘    └────┬────┘   └────┬────┘
              │              │              │
              └──────────────┼──────────────┘
                             │
                    ┌────────▼────────┐
                    │  Supervisor     │
                    │  (AI决策协调器)  │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
    ┌────▼────┐       ┌──────▼──────┐      ┌────▼────┐
    │Content  │       │Interaction  │      │Analysis │
    │Agent    │       │Agent        │      │Agent    │
    └────┬────┘       └──────┬──────┘      └────┬────┘
         │                   │                   │
         └───────────────────┼───────────────────┘
                             │
                    ┌────────▼────────┐
                    │  State Manager  │
                    │  (状态汇总节点)   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   End Node      │
                    └─────────────────┘
```

---

## 核心 Agent 节点设计

### 1. **Entry Node (请求路由器)**
**职责**: 识别输入类型并路由到相应分支
- **输入**: 用户请求/平台事件/定时触发
- **输出**: 路由决策 + 初始化状态
- **条件边**:
  - `user_request` → 用户请求分支
  - `platform_event` → 平台事件分支  
  - `scheduled_task` → 定时任务分支

---

### 2. **Supervisor (AI决策协调器)**
**职责**: 理解需求并协调下游 Agent
- **输入**: 路由后的结构化请求
- **核心功能**:
  - 需求分析与意图识别
  - 任务分解与优先级排序
  - Agent 调度决策
- **条件边**:
  - `need_content_creation` → Content Agent
  - `need_interaction` → Interaction Agent
  - `need_analysis` → Analysis Agent
  - `need_multi_agents` → 并行调用多个 Agent
  - `task_complete` → State Manager

---

### 3. **Content Agent (内容生成代理)**
**职责**: 处理所有内容创作相关任务

#### 子状态机:
```
策略规划节点
    ↓
话题选择节点
    ↓
内容生成节点 (调用AI生成文案)
    ↓
素材生成节点 (调用图视频服务)
    ↓
内容审核节点 (风险检测)
    ↓
发布执行节点 (调用小红书MCP)
    ↓
返回 Supervisor
```

**条件边**:
- 审核通过 → 发布
- 审核失败 → 重新生成或人工介入
- 热点内容 → 加速发布路径

---

### 4. **Interaction Agent (互动管理代理)**
**职责**: 处理评论、私信等互动

#### 子状态机:
```
内容分析节点 (情感分析/意图识别)
    ↓
响应策略节点 (自动回复/人工标记/忽略)
    ↓
内容生成节点 (生成回复内容)
    ↓
执行节点 (调用小红书MCP回复)
    ↓
记录节点 (更新互动历史)
    ↓
返回 Supervisor
```

**条件边**:
- 可自动处理 → 生成回复
- 需人工介入 → 标记并通知
- 敏感内容 → 风险评估

---

### 5. **Analysis Agent (分析优化代理)**
**职责**: 数据分析与策略优化

#### 子状态机:
```
数据收集节点 (调用小红书MCP获取数据)
    ↓
数据处理节点 (清洗/聚合)
    ↓
模式识别节点 (AI分析趋势)
    ↓
决策建议节点 (生成优化方案)
    ↓
策略更新节点 (更新策略库)
    ↓
异常检测节点 (并行运行)
    ↓
返回 Supervisor
```

**条件边**:
- 发现异常 → 触发异常处理流程
- 发现机会 → 触发内容创作
- 正常 → 更新策略库

---

### 6. **State Manager (状态管理节点)**
**职责**: 汇总所有 Agent 结果并持久化
- **输入**: 各 Agent 执行结果
- **功能**:
  - 合并状态更新
  - 记录执行日志
  - 触发后续任务(如需要)
- **输出**: 最终响应给用户/系统

---

## 关键工作流映射

### 流程1: 用户请求内容发布
```
Entry (user_request) 
  → Supervisor (分析需求) 
  → Content Agent (策略→生成→发布) 
  → State Manager 
  → End
```

### 流程2: 自动回复评论
```
Entry (platform_event: new_comment) 
  → Supervisor (判断互动类型) 
  → Interaction Agent (分析→生成→回复) 
  → State Manager 
  → End
```

### 流程3: 定时内容发布
```
Entry (scheduled_task: publish) 
  → Supervisor (规划内容) 
  → Content Agent (生成→发布) 
  → Analysis Agent (收集数据) [并行]
  → State Manager 
  → End
```

### 流程4: 热点追踪
```
Entry (scheduled_task: trend_monitor) 
  → Supervisor (启动热点监控) 
  → Analysis Agent (搜索→分析热点) 
  → Supervisor (评估相关性) 
  → Content Agent (快速生成→发布) [如果相关]
  → State Manager 
  → End
```

### 流程5: 数据异常处理
```
Analysis Agent (检测异常) 
  → Supervisor (异常决策) 
  → Content Agent (暂停发布) [如需]
  → Interaction Agent (通知用户) [如需]
  → State Manager (记录异常) 
  → End
```

### 流程6: 竞品分析
```
Entry (scheduled_task: competitor_analysis) 
  → Analysis Agent (搜索→分析→对比) 
  → Supervisor (评估建议) 
  → Analysis Agent (更新策略) 
  → State Manager 
  → End
```