

# 架构设计

### Supervisor 架构设计

```
┌─────────────────────────────────────────┐
│         Supervisor（主管）                │
│  ┌───────────────────────────────────┐  │
│  │  AI决策引擎                        │  │
│  │  - 理解需求                        │  │
│  │  - 分析内容                        │  │
│  │  - 生成决策                        │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │  策略管理器                         │  │
│  │  - 生成内容策略                     │  │
│  │  - 选择话题和模板                   │  │
│  │  - 优化策略                         │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │  状态管理器                         │  │
│  │  - 记录执行结果                     │  │
│  │  - 管理全局状态                     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
           │
           │ 分配任务
           ▼
┌─────────────────────────────────────────┐
│        专业智能体（Agents）               │
├─────────────────────────────────────────┤
│  • 图视频生成智能体                      │
│  • 小红书MCP服务智能体                   │
│  • 数据分析智能体                        │
│  • 内容生成智能体                        │
│  • 异常处理智能体                        │
└─────────────────────────────────────────┘
```

# 小红书的业务流程

### 流程1：用户请求内容发布

```
用户输入请求
    ↓
API服务层接收
    ↓
AI决策引擎理解需求
    ↓
策略管理器生成内容策略
    ↓
调用图视频生成服务生成素材
    ↓
调用小红书MCP服务发布内容
    ↓
状态管理器记录执行结果
    ↓
返回结果给用户
```


### 流程3：定时内容发布

```
定时任务事件触发
    ↓
AI决策引擎生成内容计划
    ↓
策略管理器选择话题和模板
    ↓
调用图视频生成服务生成素材
    ↓
调用小红书MCP服务发布
    ↓
数据分析服务收集数据
    ↓
策略管理器优化后续策略
```

## 流程4：热点内容追踪与发布

```
定时任务触发热点监控
    ↓
调用小红书MCP服务搜索热点话题
    ↓
AI决策引擎分析热点相关性
    ↓
策略管理器匹配内容策略
    ↓
AI决策引擎生成热点内容方案
    ↓
调用图视频生成服务生成素材
    ↓
调用小红书MCP服务发布热点内容
    ↓
状态管理器记录热点追踪数据
```

### 流程6：竞品分析与策略调整

```
定时任务触发竞品分析
    ↓
调用小红书MCP服务搜索竞品内容
    ↓
数据分析服务分析竞品数据
    ↓
AI决策引擎识别竞品策略
    ↓
策略管理器对比自身策略
    ↓
AI决策引擎生成优化建议
    ↓
策略管理器更新运营策略
    ↓
状态管理器记录分析结果
```
# 小红书的mcp的功能


### 1. **登录相关**
- `check_login_status` - 检查登录状态
- `get_login_qrcode` - 获取登录二维码（返回 Base64 图片）

### 2. **内容发布**
- `publish_content` - 发布图文内容（支持标题、正文、图片、标签）
- `publish_with_video` - 发布视频内容（仅支持本地视频文件）

### 3. **内容浏览**
- `list_feeds` - 获取用户发布的内容列表
- `search_feeds` - 搜索小红书内容（需登录）
- `get_feed_detail` - 获取笔记详情（内容、图片、作者、互动数据、评论）

### 4. **用户信息**
- `user_profile` - 获取用户主页（基本信息、关注/粉丝/获赞、笔记列表）

### 5. **互动操作**
- `like_feed` - 点赞/取消点赞笔记
- `favorite_feed` - 收藏/取消收藏笔记
- `post_comment_to_feed` - 发表评论到笔记

所有接口通过 MCP（Model Context Protocol）协议提供，支持通过 AI 助手调用这些功能进行小红书内容管理和互动。

# langchain/langgraph连接mcp
```
from langchain_mcp_adapters.client import MultiServerMCPClient
from langgraph.prebuilt import create_react_agent
from langchain_deepseek import ChatDeepSeek

# 初始化 LLM
llm = ChatDeepSeek(
    model="deepseek-chat",
    api_key="your-api-key"
)

# 连接 MCP 服务器（这里连接的是别人提供的服务）
client = MultiServerMCPClient({
    "weather": {
        "url": "http://localhost:8000/mcp",  # 远程 MCP 服务的 HTTP 端点
        "transport": "streamable_http",
    }
})

# 获取工具
tools = await client.get_tools()

# 创建 Agent
agent = create_react_agent(llm, tools)

# 调用 Agent
response = await agent.ainvoke({
    "messages": "今天天气怎么样？"
})
```